# Dependency Injection

ใน React มักจะมีการใช้ [dependency injection](https://www.youtube.com/watch?v=IKD2-MAkXyQ) กันอยู่บ่อยๆ ลองมาดูตัวอย่าง application tree ข้างล่างกัน

```javascript
// Title.jsx
export default function Title(props) {
  return <h1>{ props.title }</h1>;
}
```

```javascript
// Header.jsx
import Title from './Title.jsx';
export default function Header() {
  return (
    <header>
      <Title />
    </header>
  );
}
```
```javascript
// App.jsx
import Header from './Header.jsx';
class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = { title: 'React Dependency Injection' };
  }
  render() {
    return <Header />;
  }
}
```
คำว่า "React Dependency Injection" นี้สุดท้ายแล้วควรจะถูกส่งไปถึง Title component วิธีตรงๆ ที่ทำได้ก็คือส่งผ่านค่านี้จาก App ไปให้ Header แล้วให้ Header ส่งต่อไปให้ Title สำหรับกรณีนี้ที่มีแค่ 3 component วิธีนี้มันก็ดูโอเค  

แต่พอลองคิดดูอีกที ถ้าเรามีค่าที่ต้องการส่งเยอะ หรือมี component ซ้อนกันหลายๆ ชั้น (deeper nesting) component พวกนั้นก็ต้องอ้างถึง หรือส่งผ่านค่าที่มันไม่ได้ใช้งานติดไปด้วย  

ดังนั้น React component จึงใช้วิธีรับ dependency ของมันด้วยการส่งค่าผ่าน `props` แทน คำถามต่อมาก็คือ `props` มันถูกส่งไปได้ยังไงล่ะ?


คำตอบก็คือการทำ Dependency Injection โดยใช้ higher-order component (HOC) ในการ inject ข้อมูลเข้าไป

```javascript
// inject.jsx
var title = 'React Dependency Injection';
export default function inject(Component) {
  return class Injector extends React.Component {
    render() {
      return (
        <Component
          {...this.state}
          {...this.props}
          title={ title }
        />
      )
    }
  };
}
```
```javascript
// Title.jsx
export default function Title(props) {
  return <h1>{ props.title }</h1>;
}
```
```javascript
// Header.jsx
import inject from './inject.jsx';
import Title from './Title.jsx';

var EnhancedTitle = inject(Title);
export default function Header() {
  return (
    <header>
      <EnhancedTitle />
    </header>
  );
}
```
จะเห็นว่าส่วนที่ส่งค่า title จะไปอยู่ที่อีก component นึงแทน (เรียกว่า higher-order component) โดยส่งค่า title เป็น prop ไปให้ component จริงๆ ของ Title  

ซึ่งวิธีนี้ก็ดีแล้วล่ะ แต่มันยังแก้ปัญหาไม่ได้ทั้งหมด ตอนนี้เราไม่ต้องส่งผ่านค่า title ลงไปแต่ละ component เรื่อยๆ แล้ว แต่ส่วน enhance.jsx จะเรียกใช้ค่านั้นได้ยังไงล่ะ?

วิธีก็คือจะใช้ React's context โดย React จะมี context ที่ทุก component สามารถเข้าถึงได้จากทุกที่ (เป็น single model) ในที่นี้ context ก็คล้ายๆ event bus แต่ใช้กับการส่งข้อมูลแทน

เราจะ define ค่า context แบบนี้
```javascript
var context = { title: 'React in patterns' };
class App extends React.Component {
  getChildContext() {
    return context;
  }
  // ...
}

App.childContextTypes = {
  title: PropTypes.string
};
```
และจะเรียกใช้แบบนี้
```javascript
class Inject extends React.Component {
  render() {
    var title = this.context.title;
  // ...
  }
}
Inject.contextTypes = {
  title: PropTypes.string
};
```

### links ที่เกี่ยวข้อง:
- [What is Dependency Injection?](https://www.youtube.com/watch?v=IKD2-MAkXyQ)
- [The Basics of Dependency Injection](https://www.youtube.com/watch?v=jXhdOTw1q5Q)
- [Dependency injection in JavaScript](http://krasimirtsonev.com/blog/article/Dependency-injection-in-JavaScript)
- [DI In React](https://github.com/krasimir/react-in-patterns/tree/master/patterns/dependency-injection)
