# Dependency Injection

ใน React มักจะมีการใช้ [dependency injection](https://www.youtube.com/watch?v=IKD2-MAkXyQ) กันอยู่บ่อยๆ ลองมาดูตัวอย่าง application tree ข้างล่างนี้ก่อน

```javascript
// Title.jsx
export default function Title(props) {
  return <h1>{ props.title }</h1>;
}
```

```javascript
// Header.jsx
import Title from './Title.jsx';
export default function Header() {
  return (
    <header>
      <Title />
    </header>
  );
}
```
```javascript
// App.jsx
import Header from './Header.jsx';
class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = { title: 'React Dependency Injection' };
  }
  render() {
    return <Header />;
  }
}
```
สุดท้ายแล้วคำว่า "React Dependency Injection" นี้ควรจะไปถึง Title component วิธีตรงๆ ที่ทำได้ก็คือส่งผ่านค่านี้จาก App ไปให้ Header แล้วให้ Header ส่งต่อไปให้ Title สำหรับกรณีนี้ที่มีเพียง 3 component วิธีนี้มันใช้งานได้ก็จริง แต่ลองคิดดูว่าจะเป็นยังไงถ้ามีค่าที่ต้องการส่งมากมาย หรือมี component ซ้อนกันหลายๆ ชั้น (deeper nesting) component พวกนั้นก็ต้องอ้างถึงหรือส่งผ่านค่าที่มันไม่ได้ใช้งาน ดังนั้นจะเห็นว่าวิธีที่ React component ใช้รับ dependency ของมันก็คือส่งค่าผ่าน props คำถามต่อมาก็คือ props มันถูกส่งไปได้ยังไงล่ะ?


วิธีที่ใช้ก็คือทำ dependency injection โดยใช้ higher-order component ในการ inject ข้อมูล

```javascript
// inject.jsx
var title = 'React Dependency Injection';
export default function inject(Component) {
  return class Injector extends React.Component {
    render() {
      return (
        <Component
          {...this.state}
          {...this.props}
          title={ title }
        />
      )
    }
  };
}
```
```javascript
// Title.jsx
export default function Title(props) {
  return <h1>{ props.title }</h1>;
}
```
```javascript
// Header.jsx
import inject from './inject.jsx';
import Title from './Title.jsx';

var EnhancedTitle = inject(Title);
export default function Header() {
  return (
    <header>
      <EnhancedTitle />
    </header>
  );
}
```
ในที่นี้ title ถูกซ่อนอยู่ตรง middle layer ที่เรียกว่า higher-order component ซึ่งเราส่งค่า title เป็น prop ไปให้ component จริงๆ ของ Title
The title is hidden in a middle layer (higher-order component) where we pass it as a prop to the original Title component.
That's all nice but it solves only half of the problem.
Now we don't have to pass the title down the tree but how this data will reach the enhance.jsx helper.

Using React's context
React has the concept of context. The context is something that every component may have access to.
It's something like an event bus but for data. A single model which we can access from everywhere.

a place where we'll define the context
```javascript
var context = { title: 'React in patterns' };
class App extends React.Component {
  getChildContext() {
    return context;
  }
  // ...
}

App.childContextTypes = {
  title: PropTypes.string
};
```
A place where we need data
```javascript
class Inject extends React.Component {
  render() {
    var title = this.context.title;
  // ...
  }
}
Inject.contextTypes = {
  title: PropTypes.string
};
```

### Related links:
- [What is Dependency Injection?](https://www.youtube.com/watch?v=IKD2-MAkXyQ)
- [The Basics of Dependency Injection](https://www.youtube.com/watch?v=jXhdOTw1q5Q)
- [Dependency injection in JavaScript](http://krasimirtsonev.com/blog/article/Dependency-injection-in-JavaScript)
- [DI In React](https://github.com/krasimir/react-in-patterns/tree/master/patterns/dependency-injection)
